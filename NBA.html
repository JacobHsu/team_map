<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA 球隊位置互動儀表板</title>
    <link rel="icon" type="image/png" href="https://www.nba.com/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <!-- Sportradar Widget Loader -->
    <script type="application/javascript" src="https://widgets.media.sportradar.com/uscommon/widgetloader" data-sr-language="en_us" async></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            /* 更新: 使用 Roboto 作為全局字體 */
            font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            overflow: hidden;
        }
        .dashboard-container {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 15px;
            box-sizing: border-box;
        }
        h1 {
            color: #1a237e;
            text-align: center;
            margin: 0 0 15px 0;
            flex-shrink: 0;
            font-weight: 700;
        }
        .main-content {
            display: flex;
            flex-grow: 1;
            gap: 15px;
            overflow: hidden;
        }
        .legend-sidebar {
            flex: 1;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            padding: 15px 20px;
            overflow-y: auto;
        }
        #map-container {
            flex: 2.5;
            display: flex;
        }
        #map {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            border: 1px solid #ccc;
        }
        .league-column h3 {
            color: #c9082a; /* NBA Red */
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 8px;
            margin-top: 0;
            position: sticky;
            top: -15px;
            background-color: #ffffff;
            z-index: 10;
        }
        .division-block h4 {
            color: #17408b; /* NBA Blue */
            margin-top: 15px;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            padding: 7px 5px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
        }
        .legend-item:hover {
            background-color: #e3f2fd;
        }
        .legend-item img {
            width: 28px; /* 微調圖示大小 */
            height: 28px;
            margin-right: 12px;
            object-fit: contain;
            flex-shrink: 0;
        }
        .team-name-container {
            line-height: 1.45;
            pointer-events: none;
        }
        .team-name-container .name-zh {
            font-size: 14px;
            font-weight: 700; /* 使用 Bold 字重 */
            color: #000;
        }
        .legend-item .polymarket-logo {
            width: 32px;
            height: 32px;
            margin-left: auto;
            object-fit: cover;
            border-radius: 4px;
            flex-shrink: 0;
        }
        /* -- 更新: 優化英文和縮寫的樣式 -- */
        .team-name-container .name-en-abbr {
            font-size: 13px;  /* 放大字體 */
            color: #555;      /* 使用清晰的深灰色 */
        }
        .leaflet-control-reset {
            background-color: white;
            width: 34px;
            height: 34px;
            border-radius: 4px;
            border: 2px solid rgba(0,0,0,0.2);
            background-clip: padding-box;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .leaflet-control-reset:hover {
            background-color: #f4f4f4;
        }
        .leaflet-control-reset svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }
        .leaflet-control-odds {
            background-color: white;
            width: 34px;
            height: 34px;
            border-radius: 4px;
            border: 2px solid rgba(0,0,0,0.2);
            background-clip: padding-box;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .leaflet-control-odds:hover {
            background-color: #f4f4f4;
        }
        .leaflet-control-odds svg {
            width: 20px;
            height: 20px;
            fill: #333;
        }
        .leaflet-tooltip.custom-tooltip {
            background-color: rgba(255, 255, 255, 0.95);
            border: 1px solid #999;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            padding: 10px;
            line-height: 1.5;
        }
        .tooltip-location {
            font-size: 15px;
            font-weight: 700;
            color: #000;
            border-bottom: 1px solid #eee;
            padding-bottom: 4px;
            margin-bottom: 4px;
        }
        .tooltip-details { 
            color: #333; 
            font-size: 14px;
        }
        .tooltip-details .name-en {
            color: #555;
            font-size: 13px;
        }

        /* Sportradar Score Ticker Styles */
        .score-ticker-container {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            padding: 10px;
            flex-shrink: 0;
        }

        .sr-widget {
            width: 100%;
            min-height: 60px;
        }

        /* Hide Sportradar widget when not on localhost */
        .score-ticker-container.hidden {
            display: none;
        }

        /* Fallback message for non-localhost environments */
        .ticker-fallback {
            display: none;
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        .ticker-fallback.show {
            display: block;
        }
    </style>
</head>
<body>

    <div class="dashboard-container">
        <h1>NBA 球隊位置互動儀表板</h1>

        <!-- Sportradar Score Ticker -->
        <div class="score-ticker-container" id="scoreTickerContainer">
            <div class="sr-widget" data-sr-widget="us.common.scoreTicker" data-sr-sport="nba"></div>
        </div>

        <div class="main-content">
            <div class="legend-sidebar">
                <div class="league-column">
                    <h3>東區聯盟 (Eastern Conference)</h3>
                    <div id="east-atlantic-legend" class="division-block"><h4>大西洋組 (Atlantic)</h4></div>
                    <div id="east-central-legend" class="division-block"><h4>中央組 (Central)</h4></div>
                    <div id="east-southeast-legend" class="division-block"><h4>東南組 (Southeast)</h4></div>
                </div>
            </div>
            <div id="map-container">
                <div id="map"></div>
            </div>
            <div class="legend-sidebar">
                <div class="league-column">
                    <h3>西區聯盟 (Western Conference)</h3>
                    <div id="west-northwest-legend" class="division-block"><h4>西北組 (Northwest)</h4></div>
                    <div id="west-pacific-legend" class="division-block"><h4>太平洋組 (Pacific)</h4></div>
                    <div id="west-southwest-legend" class="division-block"><h4>西南組 (Southwest)</h4></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check if running on localhost and manage Sportradar widget visibility
        function checkLocalhost() {
            const isLocalhost = window.location.hostname === 'localhost' ||
                                window.location.hostname === '127.0.0.1' ||
                                window.location.hostname === '' ||
                                window.location.protocol === 'file:';

            const tickerContainer = document.getElementById('scoreTickerContainer');

            if (isLocalhost) {
                // Show Sportradar widget on localhost
                tickerContainer.classList.remove('hidden');
            } else {
                // Hide Sportradar widget and show fallback on deployed sites
                tickerContainer.classList.add('hidden');
            }
        }

        // Run the check when page loads
        document.addEventListener('DOMContentLoaded', checkLocalhost);

        const initialCenter = [39.8283, -98.5795];
        const initialZoom = 4;

        const map = L.map('map').setView(initialCenter, initialZoom);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
        }).addTo(map);

        const teams = [
            // Eastern Conference - Atlantic
            { name: "波士頓塞爾提克", name_en: "Boston Celtics", abbr: "BOS", city: "波士頓", state: "MA", lat: 42.3662, lon: -71.0621, logo: "https://a.espncdn.com/i/teamlogos/nba/500/bos.png", league: "East", division: "Atlantic" },
            { name: "布魯克林籃網", name_en: "Brooklyn Nets", abbr: "BKN", city: "布魯克林", state: "NY", lat: 40.6826, lon: -73.9754, logo: "https://a.espncdn.com/i/teamlogos/nba/500/bkn.png", league: "East", division: "Atlantic" },
            { name: "紐約尼克", name_en: "New York Knicks", abbr: "NYK", city: "紐約", state: "NY", lat: 40.7505, lon: -73.9934, logo: "https://a.espncdn.com/i/teamlogos/nba/500/nyk.png", league: "East", division: "Atlantic" },
            { name: "費城76人", name_en: "Philadelphia 76ers", abbr: "PHI", city: "費城", state: "PA", lat: 39.9012, lon: -75.1720, logo: "https://a.espncdn.com/i/teamlogos/nba/500/phi.png", league: "East", division: "Atlantic" },
            { name: "多倫多暴龍", name_en: "Toronto Raptors", abbr: "TOR", city: "多倫多", state: "ON", lat: 43.6435, lon: -79.3791, logo: "https://a.espncdn.com/i/teamlogos/nba/500/tor.png", league: "East", division: "Atlantic" },
            
            // Eastern Conference - Central
            { name: "芝加哥公牛", name_en: "Chicago Bulls", abbr: "CHI", city: "芝加哥", state: "IL", lat: 41.8807, lon: -87.6742, logo: "https://a.espncdn.com/i/teamlogos/nba/500/chi.png", league: "East", division: "Central" },
            { name: "克里夫蘭騎士", name_en: "Cleveland Cavaliers", abbr: "CLE", city: "克里夫蘭", state: "OH", lat: 41.4966, lon: -81.6882, logo: "https://a.espncdn.com/i/teamlogos/nba/500/cle.png", league: "East", division: "Central" },
            { name: "底特律活塞", name_en: "Detroit Pistons", abbr: "DET", city: "底特律", state: "MI", lat: 42.3411, lon: -83.0550, logo: "https://a.espncdn.com/i/teamlogos/nba/500/det.png", league: "East", division: "Central" },
            { name: "印第安納溜馬", name_en: "Indiana Pacers", abbr: "IND", city: "印第安納波利斯", state: "IN", lat: 39.7640, lon: -86.1555, logo: "https://a.espncdn.com/i/teamlogos/nba/500/ind.png", league: "East", division: "Central" },
            { name: "密爾瓦基公鹿", name_en: "Milwaukee Bucks", abbr: "MIL", city: "密爾瓦基", state: "WI", lat: 43.0451, lon: -87.9174, logo: "https://a.espncdn.com/i/teamlogos/nba/500/mil.png", league: "East", division: "Central" },

            // Eastern Conference - Southeast
            { name: "亞特蘭大老鷹", name_en: "Atlanta Hawks", abbr: "ATL", city: "亞特蘭大", state: "GA", lat: 33.7573, lon: -84.3963, logo: "https://a.espncdn.com/i/teamlogos/nba/500/atl.png", league: "East", division: "Southeast" },
            { name: "夏洛特黃蜂", name_en: "Charlotte Hornets", abbr: "CHA", city: "夏洛特", state: "NC", lat: 35.2251, lon: -80.8392, logo: "https://a.espncdn.com/i/teamlogos/nba/500/cha.png", league: "East", division: "Southeast" },
            { name: "邁阿密熱火", name_en: "Miami Heat", abbr: "MIA", city: "邁阿密", state: "FL", lat: 25.7814, lon: -80.1870, logo: "https://a.espncdn.com/i/teamlogos/nba/500/mia.png", league: "East", division: "Southeast" },
            { name: "奧蘭多魔術", name_en: "Orlando Magic", abbr: "ORL", city: "奧蘭多", state: "FL", lat: 28.5392, lon: -81.3839, logo: "https://a.espncdn.com/i/teamlogos/nba/500/orl.png", league: "East", division: "Southeast" },
            { name: "華盛頓巫師", name_en: "Washington Wizards", abbr: "WAS", city: "華盛頓特區", state: "DC", lat: 38.8982, lon: -77.0209, logo: "https://a.espncdn.com/i/teamlogos/nba/500/was.png", league: "East", division: "Southeast" },

            // Western Conference - Northwest
            { name: "丹佛金塊", name_en: "Denver Nuggets", abbr: "DEN", city: "丹佛", state: "CO", lat: 39.7487, lon: -105.0076, logo: "https://a.espncdn.com/i/teamlogos/nba/500/den.png", league: "West", division: "Northwest" },
            { name: "明尼蘇達灰狼", name_en: "Minnesota Timberwolves", abbr: "MIN", city: "明尼亞波利斯", state: "MN", lat: 44.9795, lon: -93.2761, logo: "https://a.espncdn.com/i/teamlogos/nba/500/min.png", league: "West", division: "Northwest" },
            { name: "奧克拉荷馬雷霆", name_en: "Oklahoma City Thunder", abbr: "OKC", city: "奧克拉荷馬市", state: "OK", lat: 35.4634, lon: -97.5151, logo: "https://a.espncdn.com/i/teamlogos/nba/500/okc.png", league: "West", division: "Northwest" },
            { name: "波特蘭拓荒者", name_en: "Portland Trail Blazers", abbr: "POR", city: "波特蘭", state: "OR", lat: 45.5316, lon: -122.6668, logo: "https://a.espncdn.com/i/teamlogos/nba/500/por.png", league: "West", division: "Northwest" },
            { name: "猶他爵士", name_en: "Utah Jazz", abbr: "UTA", city: "鹽湖城", state: "UT", lat: 40.7683, lon: -111.9011, logo: "https://a.espncdn.com/i/teamlogos/nba/500/utah.png", league: "West", division: "Northwest" },

            // Western Conference - Pacific
            { name: "金州勇士", name_en: "Golden State Warriors", abbr: "GSW", city: "舊金山", state: "CA", lat: 37.7680, lon: -122.3877, logo: "https://a.espncdn.com/i/teamlogos/nba/500/gsw.png", league: "West", division: "Pacific" },
            { name: "洛杉磯快艇", name_en: "LA Clippers", abbr: "LAC", city: "洛杉磯", state: "CA", lat: 34.0430, lon: -118.2673, logo: "https://a.espncdn.com/i/teamlogos/nba/500/lac.png", league: "West", division: "Pacific" },
            { name: "洛杉磯湖人", name_en: "Los Angeles Lakers", abbr: "LAL", city: "洛杉磯", state: "CA", lat: 34.0430, lon: -118.2673, logo: "https://a.espncdn.com/i/teamlogos/nba/500/lal.png", league: "West", division: "Pacific" },
            { name: "鳳凰城太陽", name_en: "Phoenix Suns", abbr: "PHX", city: "鳳凰城", state: "AZ", lat: 33.4457, lon: -112.0712, logo: "https://a.espncdn.com/i/teamlogos/nba/500/phx.png", league: "West", division: "Pacific" },
            { name: "沙加緬度國王", name_en: "Sacramento Kings", abbr: "SAC", city: "沙加緬度", state: "CA", lat: 38.5802, lon: -121.4997, logo: "https://a.espncdn.com/i/teamlogos/nba/500/sac.png", league: "West", division: "Pacific" },

            // Western Conference - Southwest
            { name: "達拉斯獨行俠", name_en: "Dallas Mavericks", abbr: "DAL", city: "達拉斯", state: "TX", lat: 32.7905, lon: -96.8103, logo: "https://a.espncdn.com/i/teamlogos/nba/500/dal.png", league: "West", division: "Southwest" },
            { name: "休士頓火箭", name_en: "Houston Rockets", abbr: "HOU", city: "休士頓", state: "TX", lat: 29.7508, lon: -95.3621, logo: "https://a.espncdn.com/i/teamlogos/nba/500/hou.png", league: "West", division: "Southwest" },
            { name: "曼菲斯灰熊", name_en: "Memphis Grizzlies", abbr: "MEM", city: "曼菲斯", state: "TN", lat: 35.1381, lon: -90.0506, logo: "https://a.espncdn.com/i/teamlogos/nba/500/mem.png", league: "West", division: "Southwest" },
            { name: "紐奧良鵜鶘", name_en: "New Orleans Pelicans", abbr: "NOP", city: "紐奧良", state: "LA", lat: 29.9490, lon: -90.0821, logo: "https://a.espncdn.com/i/teamlogos/nba/500/no.png", league: "West", division: "Southwest" },
            { name: "聖安東尼奧馬刺", name_en: "San Antonio Spurs", abbr: "SAS", city: "聖安東尼奧", state: "TX", lat: 29.4270, lon: -98.4375, logo: "https://a.espncdn.com/i/teamlogos/nba/500/sas.png", league: "West", division: "Southwest" }
        ];

        const markers = {};
        let activeMarker = null;

        L.Control.ResetView = L.Control.extend({
            onAdd: function(map) {
                const btn = L.DomUtil.create('div', 'leaflet-control-reset leaflet-bar');
                btn.title = '恢復預設視圖';
                btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/><path d="M0 0h24v24H0z" fill="none"/></svg>';
                L.DomEvent.on(btn, 'click', function (e) {
                    L.DomEvent.stop(e);
                    map.flyTo(initialCenter, initialZoom);
                    if (activeMarker) {
                        activeMarker.closeTooltip();
                        activeMarker = null;
                    }
                });
                return btn;
            },
            onRemove: function(map) { }
        });
        L.control.resetView = (opts) => new L.Control.ResetView(opts);
        L.control.resetView({ position: 'topleft' }).addTo(map);

        L.Control.OddsLink = L.Control.extend({
            onAdd: function(map) {
                const btn = L.DomUtil.create('div', 'leaflet-control-odds leaflet-bar');
                btn.title = '賠率截圖';
                btn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 2h2v4h-2V5zm-4 8h2v6H8v-6zm8-2h2v8h-2v-8zm-4 4h2v4h-2v-4zM8 7h2v4H8V7z"/></svg>';
                L.DomEvent.on(btn, 'click', function (e) {
                    L.DomEvent.stop(e);
                    window.open('https://screenshotsnap.com/api/screenshot?url=https://www.oddsportal.com/basketball/usa/nba/', '_blank');
                });
                return btn;
            },
            onRemove: function(map) { }
        });
        L.control.oddsLink = (opts) => new L.Control.OddsLink(opts);
        L.control.oddsLink({ position: 'topright' }).addTo(map);

        teams.forEach(team => {
            const teamIcon = L.icon({
                iconUrl: team.logo,
                iconSize: [40, 40],
                iconAnchor: [20, 20],
                popupAnchor: [0, -20]
            });
            const marker = L.marker([team.lat, team.lon], { icon: teamIcon }).addTo(map);
            const tooltipContent = `
                <div class="tooltip-location">${team.city}, ${team.state}</div>
                <div class="tooltip-details">
                    ${team.name} (${team.abbr})<br>
                    <span class="name-en">${team.name_en}</span>
                </div>
            `;
            marker.bindTooltip(tooltipContent, {
                permanent: false,
                direction: 'top',
                offset: [0, -20],
                className: 'custom-tooltip'
            });
            markers[team.abbr] = marker;

            const targetDivId = `${team.league.toLowerCase()}-${team.division.toLowerCase()}-legend`;
            const legendContainer = document.getElementById(targetDivId);
            const legendItem = document.createElement('div');
            legendItem.className = 'legend-item';
            legendItem.dataset.teamAbbr = team.abbr;
            legendItem.innerHTML = `
                <img src="${team.logo}" alt="${team.name}">
                <div class="team-name-container">
                    <div class="name-zh">${team.name}</div>
                    <div class="name-en-abbr">${team.name_en} (${team.abbr})</div>
                </div>
                <img class="polymarket-logo" src="https://polymarket.com/_next/image?url=https%3A%2F%2Fpolymarket-upload.s3.us-east-2.amazonaws.com%2FNBA%2BTeam%2BLogos%2F${team.abbr}.png&w=96&q=75" alt="${team.abbr}" onerror="this.style.display='none'">
            `;
            
            legendItem.addEventListener('click', function() {
                const teamAbbr = this.dataset.teamAbbr;
                const targetMarker = markers[teamAbbr];
                if (targetMarker) {
                    if (activeMarker && activeMarker !== targetMarker) {
                        activeMarker.closeTooltip();
                    }
                    map.flyTo(targetMarker.getLatLng(), 8);
                    map.once('moveend', () => {
                        targetMarker.openTooltip();
                        activeMarker = targetMarker;
                    });
                }
            });

            if (legendContainer) {
                legendContainer.appendChild(legendItem);
            }
        });
    </script>

</body>
</html>
